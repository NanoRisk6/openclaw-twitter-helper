#!/bin/zsh
set -euo pipefail
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PY_BIN="python3"
if [[ -x "$SCRIPT_DIR/.venv/bin/python" ]]; then
  PY_BIN="$SCRIPT_DIR/.venv/bin/python"
fi
GLOBAL_ARGS=()
while [[ $# -gt 0 ]]; do
  case "$1" in
    --env-file|--account)
      GLOBAL_ARGS+=("$1")
      shift
      if [[ $# -gt 0 ]]; then
        GLOBAL_ARGS+=("$1")
        shift
      fi
      ;;
    --*)
      GLOBAL_ARGS+=("$1")
      shift
      ;;
    *)
      break
      ;;
  esac
done

FIRST_ARG="${1:-}"

# Easy restart aliases for users/subagents.
case "$FIRST_ARG" in
  restart|recover|fix|reboot)
    shift || true
    exec "$PY_BIN" "$SCRIPT_DIR/src/twitter_helper.py" "${GLOBAL_ARGS[@]}" restart-setup "$@"
    ;;
  diagnose|auto-diagnose|claude-diagnose)
    shift || true
    exec "$PY_BIN" "$SCRIPT_DIR/src/twitter_helper.py" "${GLOBAL_ARGS[@]}" auto-diagnose "$@"
    ;;
esac

# If caller passed a real subcommand, forward directly.
case "$FIRST_ARG" in
  setup|auth-login|doctor|auto-diagnose|app-settings|walkthrough|openclaw-status|check-auth|post|openclaw-autopost|openclaw|thread|run-twitter-helper|seamless|restart-setup|browse-twitter|mentions|search|inspire-tweets|reply-discover|reply-rank|reply-ideas|reply-run|reply-discover-run|reply-approve|reply-twitter-helper|reply-twitter-e2e|reply-quick)
    exec "$PY_BIN" "$SCRIPT_DIR/src/twitter_helper.py" "${GLOBAL_ARGS[@]}" "$@"
    ;;
  *)
    # Otherwise use the one-command workflow by default.
    exec "$PY_BIN" "$SCRIPT_DIR/src/twitter_helper.py" "${GLOBAL_ARGS[@]}" run-twitter-helper "$@"
    ;;
esac
